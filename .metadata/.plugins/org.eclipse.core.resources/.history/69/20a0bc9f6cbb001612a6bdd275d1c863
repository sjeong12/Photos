<%@ page language="java" import="java.sql.*" contentType="text/html; charset=utf-8"%>
<%@ page import="com.oreilly.servlet.MultipartRequest, com.oreilly.servlet.multipart.DefaultFileRenamePolicy" %>
<% request.setCharacterEncoding("utf-8"); %>
<%
String realFolder = "";
String saveFolder = "WebContent/memberImage";
String encType = "utf-8";

int sizeLimit = 10 * 1024 * 1024;
realFolder = application.getRealPath(saveFolder);
MultipartRequest multi= new MultipartRequest(request,realFolder,sizeLimit,encType);
// 단계1 : JDBC 드라이버 로드
Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");
// 단계2 : 커넥션 객체 생성
String connectionURL = "jdbc:sqlserver://localhost:1433;databaseName=kbs12;user=sa;password=11";
Connection con = DriverManager.getConnection(connectionURL);
//단계3 :  객체 생성
//PreparedStatement pstmt = null;
Statement stmt = con.createStatement();
//단계4 :폼에서 입력한 값을 받아서 각각의 메모리 변수에 저장
String suserid= multi.getParameter("userid");
String susernm= multi.getParameter("usernm");
String spasswd= multi.getParameter("passwd");
//주민번호 앞 6자와 뒷 7자를 각각  입력받아 합침
String sjumin= multi.getParameter("jumin1") + multi.getParameter("jumin2");
String smailrcv= multi.getParameter("mailrcv");
if (smailrcv != null && smailrcv.equals("on"))
   smailrcv = "Y";// 수신을 동의함(체크함)
else
  smailrcv = "N";// 수신을 체크하지 않음

String sgender= multi.getParameter("gender");
String sjob= multi.getParameter("job");
String sintro= multi.getParameter("intro").replace("\r\n", "<br>"); // CR, LF를 <br> 태그로 변환

String fileName= multi.getFilesystemName("pict");

//단계5 : Statement 객체로 실행할 SQL 문 생성
String SQL= "update members set ";
SQL=  SQL + " usernm=  " + "'" + susernm  + "', ";
SQL=  SQL + " jumin=  " + "'" + sjumin   + "', ";
SQL=  SQL + " mailrcv  =  " + "'" + smailrcv + "', ";
SQL=  SQL + " gender=  " + "'" + sgender  + "', ";
SQL=  SQL + " jobcd=  " + "'" + sjob     + "', ";

if (fileName != null) SQL=  SQL + " pict=  " + "'" + fileName     + "', ";

SQL=  SQL + " intro=  " + "'" + sintro   + "' ";
SQL=  SQL + " where userid= '" + suserid  + "' and passwd = '" + spasswd  + "'";

int cnt = stmt.executeUpdate(SQL);

stmt.close();
con.close();
if (cnt > 0) 
{
out.println("<script language=javascript>");
out.println("alert('변경이 완료 되었습니다.');");
out.println("</script>");
}
else 
{
out.println("<script language=javascript>");
out.println("alert('변경을 하지 못 하였습니다');");
out.println("</script>");
}

 response.sendRedirect("member_list.jsp");

%>

// 단계6 : PreparedStatement 객체로 실행할 SQL 문의 ? 위치에 각각의 값을 세팅
pstmt.setString(1, susernm);
pstmt.setString(2, sjumin);
pstmt.setString(3, smailrcv);
pstmt.setString(4, sgender);
pstmt.setString(5, sjob);
pstmt.setString(6, sintro);
pstmt.setString(7, suserid);
pstmt.setString(8, spasswd);

// 단계7 : PreparedStatement 객체 실행
int cnt = pstmt.executeUpdate();

// 단계8 :객체 종료
pstmt.close();
con.close();
if (cnt > 0) 
{
     out.println("<script language=javascript>");
     out.println("alert('변경이 완료 되었습니다.');");
     out.println("</script>");
}
else 
{
     out.println("<script language=javascript>");
     out.println("alert('변경을 하지 못 하였습니다');");
     out.println("</script>");
}
     response.sendRedirect("member_list.jsp");
%>
정보 수정 됨 
