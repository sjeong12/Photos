<%@ page language="java" import="java.sql.*" contentType="text/html; charset=utf-8" %>



<script language=javascript>
function valid_check()
{

if (document.frm1.usernm.value == "")
{
alert("이름을 입력하여 주시기 바랍니다.");
document.frm1.usernm.focus();
return false;
}
if (document.frm1.passwd.value == "")
{
alert("비밀번호를 입력하여 주시기 바랍니다.");
document.frm1.passwd.focus();
return false;
}
if (document.frm1.passwd.value != document.frm1.passwd2.value)
{
alert("비밀번호가 다릅니다.  확인하여 주시기 바랍니다.");
document.frm1.passwd.focus();
return false;
}
if (document.frm1.jumin1.value.length != 6)
{
  alert("주민번호 앞 자릿수는 6자입니다.");
  document.frm1.jumin1.focus();
  return false;
}

if (document.frm1.jumin2.value.length != 7)
{
  alert("주민번호 뒷 자릿수는 7자입니다.");
  document.frm1.jumin2.focus();
  return false;
}
for (var i = 0; i < document.frm1.jumin1.value.length; i++)
{
if (document.frm1.jumin1.value.charAt(i) < "0" || document.frm1.jumin1.value.charAt(i) > "9")
{
alert("주민등록번호는 숫자만 가능합니다.");
document.frm1.jumin1.focus();
return;  }   }

for (var i = 0; i < document.frm1.jumin2.value.length; i++)
{
if (document.frm1.jumin2.value.charAt(i) < "0" || document.frm1.jumin2.value.charAt(i) > "9")
{
alert("주민등록번호는 숫자만 가능합니다.");
document.frm1.jumin2.focus();
return;  }  }  

document.frm1.submit();
}
function KeyNumber()
{
var event_key = event.keyCode;

if((event_key < 48 || event_key > 57) && (event_key != 8 && event_key != 46))
{
event.returnValue=false;
}
}
function cursor_move(a)
{

if ( a == 1 )
{
var str = document.frm1.jumin1.value.length;
if (str == 6) 
document.frm1.jumin2.focus();
}
else if ( a == 2 )
{
var str = document.frm1.jumin2.value.length;
if (str == 7) 
document.frm1.mailrcv.focus();
}
}
 </script>



<%
String in_userid = request.getParameter("puserid");
//String usernm = request.getParameter("pusernm");
//String in_jumin1 = request.getParameter("pjumin1");
//String in_jumin2 = request.getParameter("pjumin2");

Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");
String connectionURL = "jdbc:sqlserver://localhost:1433;databaseName=lsj1531;user=sa;password=11";
Connection con = DriverManager.getConnection(connectionURL);
PreparedStatement pstmt = null;
ResultSet rs = null;

String SQL = "select * from members where userid = ?";
pstmt = con.prepareStatement(SQL);
pstmt.setString(1, in_userid);
rs = pstmt.executeQuery();

if (rs.next()==false)
	   out.print("등록되지 않은 회원입니다.");
	else
	{
		String usernm= rs.getString("usernm");
		String jumin= rs.getString("jumin");
		String jumin1= "";
		String jumin2= "";
	          if (jumin != null)  {
		jumin1= jumin.substring(0, 6);
		jumin2= jumin.substring(6);
		}
			String mailrcv= rs.getString("mailrcv");
	   	 if (mailrcv== null) mailrcv = "N";
			String gender= rs.getString("gender");
	   	 if (gender== null) gender = "";
			String job= rs.getString("jobcd");
	  	  if (job== null) job = "";
			String intro= rs.getString("intro");
	   	  if (intro != null) intro = intro.replace("<br>", "\r\n");   
	

	   	String pict = rs.getString("pict");
	   	if(pict==null)
	   	pict="";

%>

 <h3>회원 정보 변경</h3><BODY>
<!--form action="member_join_ok.jsp" method="post"-->
<form Name="frm1" action="/ch09/member_update_ok.jsp" method="post" enctype="multipart/form-data  ">

<!--아이디 히든시키기 -->
<!-- <INPUT TYPE = "hidden" NAME = "userid" VALUE="<%=in_userid%>"> -->
<TABLE WIDTH = "500" BORDER = "1" CellPadding = "0" CellSpacing = "0">
<TR><TD WIDTH = "40%" ALIGN = "left" >아이디</TD>
<TD width = "80%" ALIGN = "left" >
<!--%=in_userid%  -->
<INPUT TYPE = "text" SIZE = "15" MAXLENGTH = "10" NAME = "userid" VALUE="<%= in_userid %>">

</TD></TR>
<TR><TD WIDTH = "40%" ALIGN = "left">이름</TD>
<TD WIDTH = "60%" ALIGN = "left">
<INPUT TYPE = "text" SIZE = "15" MAXLENGTH = "10" NAME = "usernm">
</TD></TR>
<TR><TD WIDTH = "40%" ALIGN = "left">비밀번호</TD>
<TD WIDTH = "60%" ALIGN = "left">
<INPUT TYPE = "password" SIZE = "10" MAXLENGTH = "10" NAME = "passwd">
</TD></TR>
<TR><TD WIDTH = "40%" ALIGN = "left">비밀번호확인</TD>
<TD WIDTH = "60%" ALIGN = "left">
<INPUT TYPE = "password" SIZE = "10" MAXLENGTH = "10" NAME = "passwd2">
</TD></TR>
<TR><TD WIDTH = "40%" ALIGN = "left">주민번호</TD>
        <TD WIDTH = "60%" ALIGN = "left">
       <INPUT TYPE ="text" NAME="jumin1" SIZE = "6" MAXLENGTH = "6" onKeyDown="KeyNumber()" onKeyup="cursor_move(1)" 
VALUE="<%= jumin1 %>" >-
<INPUT TYPE ="text" NAME="jumin2" SIZE = "7" MAXLENGTH = "7" onKeyDown="KeyNumber()" onKeyup="cursor_move(2)" 
VALUE="<%= jumin2 %>" >


        </TD></TR>
<TR><TD WIDTH = "40%" ALIGN = "left">메일수신여부</TD>
        <TD WIDTH = "60%" ALIGN = "left"> 동의함 <INPUT TYPE ="checkbox" NAME="mailrcv" <% if(mailrcv.equals("Y")) out.print("checked"); %>>
        </TD></TR>
<TR><TD WIDTH = "40%" ALIGN = "left">성별.</TD>
        <TD WIDTH = "60%" ALIGN = "left">
        남<INPUT TYPE ="radio" NAME="gender" VALUE="1" <% if(gender.equals("1")) out.print("checked"); %>>
        여<INPUT TYPE ="radio" NAME="gender" VALUE="2" <% if(gender.equals("2")) out.print("checked"); %>>
                                                        
        </TD></TR>
<TR><TD WIDTH = "40%" ALIGN = "left">직업</TD>
        <TD WIDTH = "60%" ALIGN = "left">
        <SELECT NAME="job">
         <OPTION VALUE="">==직업을 선택하세요==</OPTION>
         <OPTION VALUE="1"<% if (job.equals("1")) out.print (" selected");%>>학생</OPTION>
         <OPTION VALUE="2"<% if (job.equals("2"))out.print (" selected");%>>회사원</OPTION>
        <OPTION VALUE="3" <% if (job.equals("3"))out.print (" selected");%>>군인</OPTION>
        <OPTION VALUE="9"><% if (job.equals("9")) out.print (" selected");%>>기타</OPTION>
        </SELECT>
       </TD></TR>
<TR><TD WIDTH = "40%" ALIGN = "left">자기소개</TD>
<TD WIDTH = "60%" ALIGN = "left">
<TEXTAREA NAME="intro" ROWS=5 COLS=50 <%=intro %>></TEXTAREA>
</TD></TR>

<TR>
<TD WIDTH = "40%" ALIGN = "left">현재 등록사진</TD>
<TD WIDTH = "60%" ALIGN = "left">
<IMG SRC= " /ch08/image/<%= pict %>" height=100 width=150>
</TD></TR>

<TR>
<TD WIDTH = "40%" ALIGN = "left">변경 할 사진</TD>
<TD WIDTH = "60%" ALIGN = "left">
<INPUT TYPE = "file" NAME ="pict" SIZE=40>
</TD></TR>


<TR>
<TD WIDTH = "100%" ALIGN = "center" COLSPAN = "2">
<INPUT TYPE = "button" VALUE = "수정하기" onclick="valid_check()">
</TD></TR>

</TABLE></FORM>
</BODY>
<%
	}
%>
</HTML>
       